<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.merry.lotto.member.dao.MemberDao">
    
    <select id="idCheck" parameterType="String" resultType="int">
        select count(mid)
        from member
        where mid = #{userid}
    </select>
    
    <insert id="registerMember" parameterType="com.merry.lotto.member.model.MemberDetailDto">
        insert into member (mid, name, birthdate, pass, email1, email2, joindate, mstatus, admin)
            values (#{mid}, #{name}, #{birthdate}, #{pass}, #{email1}, #{email2}, now(), 'Y', 'N')
    </insert>
    
    <insert id="registerMdetail" parameterType="com.merry.lotto.member.model.MemberDetailDto">   
    	insert into mdetail (mno, tel1, tel2, tel3, zipcode, addr1, addr2, balance, withdrawal)
            values (#{mno}, #{tel1}, #{tel2}, #{tel3}, #{zipcode}, #{addr1}, #{addr2}, '0', '9999-12-31 23:59:59.999999')
    </insert>
    
    <select id="getMno" parameterType="String" resultType="int">
        select mno
        from member
        where mid = #{userid}
    </select>
    
    <select id="loginCheck" parameterType="java.util.Map" resultType="int">
        select count(1)
        from member
        where mid = #{userid} and pass = #{userpass}
    </select>

    <select id="login" parameterType="java.util.Map" resultType="com.merry.lotto.member.model.MemberDetailDto">
   		select mid, name, birthdate, pass, email1, email2, joindate, mstatus, admin, d.*
		from (select *
			from member
			where mid = #{userid} and pass = #{userpass}) m, mdetail d
		where m.mno = d.mno
    </select>
    
    

</mapper>